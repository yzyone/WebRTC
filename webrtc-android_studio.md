<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Android Studio</title><link rel="stylesheet" type="text/css" href="/+static/base.css"/><link rel="stylesheet" type="text/css" href="/+static/doc.css"/><link rel="stylesheet" type="text/css" href="/+static/prettify/prettify.css"/><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header "><div class="Header"><div class="Header-title"></div></div></header><div class="Site-content Site-Content--markdown"><div class="Container"><div class="doc"><h1><a class="h" name="Android-Studio" href="#Android-Studio"><span></span></a><a class="h" name="android-studio" href="#android-studio"><span></span></a>Android Studio</h1><div class="toc" role="navigation"><h2>Contents</h2><div class="toc-aux"><ul><li><a href="#Usage">Usage</a></li><li><a href="#Troubleshooting">Troubleshooting</a></li><li><a href="#How-It-Works">How It Works</a></li><ul><li><a href="#Excluded-Files">Excluded Files</a></li><li><a href="#Extracting-srcjars">Extracting .srcjars</a></li><li><a href="#Native-Files">Native Files</a></li></ul><li><a href="#Tips">Tips</a></li><ul><li><a href="#Useful-Shortcuts">Useful Shortcuts</a></li><li><a href="#Building-from-the-Command-Line">Building from the Command Line</a></li></ul><li><a href="#Status-as-of-May-10_2018">Status (as of May 10, 2018)</a></li><ul><li><a href="#What-works">What works</a></li><li><a href="#What-doesn_t-work-yet_crbug">What doesn&#39;t work (yet) (crbug)</a></li></ul></ul></div></div><h2><a class="h" name="Usage" href="#Usage"><span></span></a><a class="h" name="usage" href="#usage"><span></span></a>Usage</h2><p>Make sure you have followed <a href="android_build_instructions.md">android build instructions</a> already.</p><pre class="code"><span class="pln">build</span><span class="pun">/</span><span class="pln">android</span><span class="pun">/</span><span class="pln">gradle</span><span class="pun">/</span><span class="pln">generate_gradle</span><span class="pun">.</span><span class="pln">py </span><span class="pun">--</span><span class="pln">output</span><span class="pun">-</span><span class="pln">directory </span><span class="kwd">out</span><span class="pun">/</span><span class="typ">Debug</span><span class="pln">
</span></pre><p>The above commands create a project dir <code class="code">gradle</code> under your output directory. Use <code class="code">--project-dir &lt;project-dir&gt;</code> to change this.</p><p>To import the project:</p><ul><li>Use &ldquo;Import Project&rdquo;, and select the directory containing the generated project, e.g. <code class="code">out/Debug/gradle</code>.</li></ul><p>See <a href="testing/android_test_instructions.md#Using-Emulators">android_test_instructions.md</a> for more information about building and running emulators.</p><p>If you&lsquo;re asked to use Studio&rsquo;s Android SDK: No.</p><p>If you&lsquo;re asked to use Studio&rsquo;s Gradle wrapper: Yes.</p><p>You need to re-run <code class="code">generate_gradle.py</code> whenever <code class="code">BUILD.gn</code> files change.</p><p>Pass <code class="code">--canary</code> or <code class="code">--beta</code> to avoid the &ldquo;A newer version of gradle is available&rdquo; notification.</p><ul><li>After regenerating, Android Studio should prompt you to &ldquo;Sync&rdquo;. If it doesn&#39;t, try some of the following options:<ul><li>File -&gt; &ldquo;Sync Project with Gradle Files&rdquo;</li><li>Button with two arrows on the right side of the top strip.</li><li>Help -&gt; Find Action -&gt; &ldquo;Sync Project with Gradle Files&rdquo;</li><li>After <code class="code">gn clean</code> you may need to restart Android Studio.</li><li>File -&gt; &ldquo;Invalidate Caches / Restart...&rdquo;</li></ul></li></ul><h2><a class="h" name="Troubleshooting" href="#Troubleshooting"><span></span></a><a class="h" name="troubleshooting" href="#troubleshooting"><span></span></a>Troubleshooting</h2><p>If building the Gradle files in Android Studio prints an error like this:</p><pre class="code">Failed to find Platform SDK with path: platforms;android-31
</pre><p>Then it means the SDK is being updated to the new release. A workaround is to ask for an older SDK version in <code class="code">args.gn</code>:</p><pre class="code">android_sdk_version = 30
</pre><h2><a class="h" name="How-It-Works" href="#How-It-Works"><span></span></a><a class="h" name="how-it-works" href="#how-it-works"><span></span></a>How It Works</h2><p>By default, only an <code class="code">_all</code> module containing all java apk targets is generated. If just one apk target is explicitly specified, then a single apk module is generated.</p><p>To see more detailed structure of gn targets, the <code class="code">--split-projects</code> flag can be used. This will generate one module for every gn target in the dependency graph. This can be very slow when used with <code class="code">--all</code> by default.</p><h3><a class="h" name="Excluded-Files" href="#Excluded-Files"><span></span></a><a class="h" name="excluded-files" href="#excluded-files"><span></span></a>Excluded Files</h3><p>Gradle supports source directories but not source files. However, files in Chromium are used amongst multiple targets. To accommodate this, the script detects such targets and creates exclude patterns to exclude files not in the current target. The editor does not respect these exclude patterns, so the <code class="code">_all</code> pseudo module is added which includes directories from all targets. This allows imports and refactoring to be across all targets.</p><h3><a class="h" name="Extracting-srcjars" href="#Extracting-srcjars"><span></span></a><a class="h" name="extracting-srcjars" href="#extracting-srcjars"><span></span></a>Extracting .srcjars</h3><p>Most generated .java files in GN are stored as <code class="code">.srcjars</code>. Android Studio does not support them. The generator script builds and extracts them to <code class="code">extracted-srcjars/</code> subdirectories for each target that contains generated files. This is the reason that the <code class="code">_all</code> pseudo module may contain multiple copies of generated files. It can be slow to build all these generated files, so if <code class="code">--fast</code> is passed then the generator script skips building and extracting them.</p><div class="note">** TLDR:** Always re-generate project files when generated files change (this includes <code class="code">R.java</code>).</div><h3><a class="h" name="Native-Files" href="#Native-Files"><span></span></a><a class="h" name="native-files" href="#native-files"><span></span></a>Native Files</h3><p>A new experimental option is now available to enable editing native C/C++ files with Android Studio. Pass in any number of <code class="code">--native-target [target name]</code> flags in order to try it out. The target must be the full path and name of a valid gn target (no shorthands). This will require you to install <code class="code">cmake</code> and <code class="code">ndk</code> when prompted. Accept Android Studio&#39;s prompts for these SDK packages.</p><p>You need to disable a new gradle option in order to edit native files: File -&gt; Settings -&gt; Experimental -&gt; Gradle and uncheck &ldquo;Only resolve selected variants&rdquo;.</p><p>This is not necessary, but to avoid &ldquo;This file is not part of the project...&rdquo;, you can either add an extra <code class="code">--native-target</code> flag or simply copy and paste the absolute path to that file into the CMakeLists.txt file alongside the existing file paths. Note that changes to CMakeLists.txt will be overwritten on your next invocation of <code class="code">generate_gradle.py</code>.</p><p>Example:</p><pre class="code"><span class="pln">build</span><span class="pun">/</span><span class="pln">android</span><span class="pun">/</span><span class="pln">gradle</span><span class="pun">/</span><span class="pln">generate_gradle</span><span class="pun">.</span><span class="pln">py </span><span class="pun">--</span><span class="kwd">native</span><span class="pun">-</span><span class="pln">target </span><span class="com">//chrome/android:libchrome</span><span class="pln">
</span></pre><h2><a class="h" name="Tips" href="#Tips"><span></span></a><a class="h" name="tips" href="#tips"><span></span></a>Tips</h2><ul><li>Use environment variables to avoid having to specify <code class="code">--output-directory</code>.<ul><li>Example: Append <code class="code">export CHROMIUM_OUT_DIR=out; export BUILDTYPE=Debug</code> to your <code class="code">~/.bashrc</code> to always default to <code class="code">out/Debug</code>.</li></ul></li><li>Using the Java debugger is documented <a href="android_debugging_instructions.md#android-studio">here</a>.</li><li>Configuration instructions can be found <a href="http://tools.android.com/tech-docs/configuration">here</a>. One suggestions:<ul><li>Launch it with more RAM: <code class="code">STUDIO_VM_OPTIONS=-Xmx2048m /opt/android-studio-stable/bin/studio-launcher.sh</code></li></ul></li><li>If you ever need to reset it: <code class="code">rm -r ~/.AndroidStudio*/</code></li><li>Import Chromium-specific style and inspections settings:<ul><li>Help -&gt; Find Action -&gt; &ldquo;Code Style&rdquo; (settings) -&gt; Java -&gt; Scheme -&gt; Import Scheme<ul><li>Select <code class="code">tools/android/android_studio/ChromiumStyle.xml</code> -&gt; OK</li></ul></li><li>Help -&gt; Find Action -&gt; &ldquo;Inspections&rdquo; (settings) -&gt; Profile -&gt; Import profile<ul><li>Select <code class="code">tools/android/android_studio/ChromiumInspections.xml</code> -&gt; OK</li></ul></li></ul></li><li>Turn on automatic import:<ul><li>Help -&gt; Find Action -&gt; &ldquo;Auto Import&rdquo;<ul><li>Tick all the boxes under &ldquo;Java&rdquo; and change the dropdown to &ldquo;All&rdquo;.</li></ul></li></ul></li><li>Turn on documentation on mouse hover:<ul><li>Help -&gt; Find Action -&gt; &ldquo;Show quick documentation on mouse move&rdquo;</li></ul></li><li>Turn on line numbers:<ul><li>Help -&gt; Find Action -&gt; &ldquo;Show line numbers&rdquo;</li></ul></li><li>Turn off indent notification:<ul><li>Help -&gt; Find Action -&gt; &ldquo;Show notifications about detected indents&rdquo;</li></ul></li><li>Format changed files (Useful for changes made by running code inspection):<ul><li>Set up version control<ul><li>File -&gt; Settings -&gt; Version Control</li><li>Add src directories</li></ul></li><li>Commit changes and reformat<ul><li>Help -&gt; Find Action -&gt; &ldquo;Commit Changes&rdquo;</li><li>Check &ldquo;Reformat code&rdquo; &amp; &ldquo;Optimize imports&rdquo; and commit</li></ul></li></ul></li><li>Change theme from GTK+ to another one to avoid invisible menus.<ul><li>Help -&gt; Find Action -&gt; &ldquo;Theme: Settings &gt; Appearance&rdquo;</li></ul></li></ul><h3><a class="h" name="Useful-Shortcuts" href="#Useful-Shortcuts"><span></span></a><a class="h" name="useful-shortcuts" href="#useful-shortcuts"><span></span></a>Useful Shortcuts</h3><ul><li><code class="code">Shift - Shift</code>: Search to open file or perform IDE action</li><li><code class="code">Ctrl + N</code>: Jump to class</li><li><code class="code">Ctrl + Shift + T</code>: Jump to test</li><li><code class="code">Ctrl + Shift + N</code>: Jump to file</li><li><code class="code">Ctrl + F12</code>: Jump to method</li><li><code class="code">Ctrl + G</code>: Jump to line</li><li><code class="code">Shift + F6</code>: Rename variable</li><li><code class="code">Ctrl + Alt + O</code>: Organize imports</li><li><code class="code">Alt + Enter</code>: Quick Fix (use on underlined errors)</li><li><code class="code">F2</code>: Find next error</li></ul><h3><a class="h" name="Building-from-the-Command-Line" href="#Building-from-the-Command-Line"><span></span></a><a class="h" name="building-from-the-command-line" href="#building-from-the-command-line"><span></span></a>Building from the Command Line</h3><p>Gradle builds can be done from the command-line after importing the project into Android Studio (importing into the IDE causes the Gradle wrapper to be added). This wrapper can also be used to invoke gradle commands.</p><pre class="code">cd $GRADLE_PROJECT_DIR &amp;&amp; bash gradlew
</pre><p>The resulting artifacts are not terribly useful. They are missing assets, resources, native libraries, etc.</p><ul><li>Use a <a href="https://docs.gradle.org/2.14.1/userguide/gradle_daemon.html">gradle daemon</a> to speed up builds using the gradlew script:<ul><li>Add the line <code class="code">org.gradle.daemon=true</code> to <code class="code">~/.gradle/gradle.properties</code>, creating it if necessary.</li></ul></li></ul><h2><a class="h" name="Status-as-of-May-10_2018" href="#Status-as-of-May-10_2018"><span></span></a><a class="h" name="status-as-of-may-10_2018" href="#status-as-of-may-10_2018"><span></span></a>Status (as of May 10, 2018)</h2><h3><a class="h" name="What-works" href="#What-works"><span></span></a><a class="h" name="what-works" href="#what-works"><span></span></a>What works</h3><ul><li>Android Studio v3.0-v3.2.</li><li>Java editing.<ul><li>Application code in <code class="code">main</code> sourceset.</li><li>Instrumentation test code in <code class="code">androidTest</code> sourceset.</li></ul></li><li>Native code editing (experimental).</li><li>Symlinks to existing .so files in jniLibs (doesn&#39;t generate them).</li><li>Editing resource xml files</li><li>Layout editor (limited functionality).</li><li>Java debugging (see <a href="android_debugging_instructions.md#Android-Studio">here</a>).</li><li>Import resolution and refactoring across java files.</li><li>Correct lint and AndroidManifest when only one target is specified.</li><li>Emulators (more docs coming soon).</li><li>Separate Android SDK for Android Studio.</li></ul><h3><a class="h" name="What-doesn_t-work-yet_crbug" href="#What-doesn_t-work-yet_crbug"><span></span></a><a class="h" name="what-doesn_t-work-yet_crbug" href="#what-doesn_t-work-yet_crbug"><span></span></a>What doesn&#39;t work (yet) (<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=620034">crbug</a>)</h3><ul><li>Gradle being aware of assets.</li><li>Having the &ldquo;Make Project&rdquo; button work correctly.</li></ul></div></div></div><!-- default customFooter --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><div class="Footer-links"></div></div></footer><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; ga('create', 'UA-55762617-15', 'auto'); ga('send', 'pageview', {title: 'Android Studio'});</script><script async src="https://www.google-analytics.com/analytics.js"></script></body></html>